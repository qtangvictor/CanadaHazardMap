<!DOCTYPE html>
<html>
<!--This version is able to show the charts for earthquake without showing markers on the map and seperate the data from code(data stored in variable.js-->
<head>
<meta name="viewport" content="initial-scale=1.0, width=device-width" />
<link rel="stylesheet" type="text/css" href="https://js.api.here.com/v3/3.0/mapsjs-ui.css?dp-version=1549984893" />
<script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-core.js"></script>
<script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-service.js"></script>
<script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-ui.js"></script>
<script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-mapevents.js"></script>
<script src="kriging.js" type="text/javascript"></script>
<script src="variable.js" type="text/javascript"></script>
<script src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
<script type="text/javascript">
  /**  
 * An event listener is added to listen to tap events on the map.
 * Clicking on the map displays an alert box containing the latitude and longitude
 * of the location pressed.
 * @param  {H.Map} map      A HERE Map instance within the application
 */
  function getKeyByValue(object, lat,lon) {
    return Object.keys(object).find(key => object[key][0]<(lat+0.1)&&object[key][0]>(lat-0.1)&&object[key][1]<(lon+0.1)&&object[key][1]>(lon-0.1));
  }

  function Rad(d){
    return d * Math.PI / 180.0;
  }

  function GetDistance(lat1,lng1,lat2,lng2){
    var radLat1 = Rad(lat1);
    var radLat2 = Rad(lat2);
    var a = radLat1 - radLat2;
    var  b = Rad(lng1) - Rad(lng2);
    var s = 2 * Math.asin(Math.sqrt(Math.pow(Math.sin(a/2),2) +Math.cos(radLat1)*Math.cos(radLat2)*Math.pow(Math.sin(b/2),2)));
    s = s *6378.137 ;// EARTH_RADIUS;
    s = Math.round(s * 10000) / 10000; //输出为公里
    //s=s.toFixed(4);
    return s;
  }

  function plot_earthquake(lat,lon,earthquake_data){
    //initiate a canvas
    var time=[0,0.2,0.5,1,2,5,10];
    var canvas=document.getElementById("cavsElem");
    var ctx = canvas.getContext( '2d' );
    canvas.height=canvas.height;
    //get the earthquake data of the nearest station
    var dist_array=earthquake_data.map(function(s){return GetDistance(s[0],s[1],lat,lon)});
    var len=dist_array.length;
    var dist_min=Infinity;
    while (len--){
      dist_min=dist_array[len]<dist_min?dist_array[len]:dist_min;// can not use Math.min here due to exceeded stack
    }
    idx=dist_array.indexOf(dist_min);
    var data=earthquake_data[idx].slice(2,9);
    //start plotting
    var x0=50,y0=250; //origin point
    var x1=280,y1=250;// The end point of x axis
    var x2=50,y2=30;//The end point of y axis
    var arrowWith = 10;
    //plot x axis
    ctx.beginPath();
    ctx.moveTo(x0, y0);
    ctx.lineTo( x1,y1);
    ctx.lineTo( x1 - arrowWith, y1 - arrowWith);
    ctx.moveTo(x1,y1);
    ctx.lineTo( x1 - arrowWith, y1 + arrowWith);
    ctx.strokeStyle = 'green';
    ctx.stroke();
    //plot y axis
    ctx.beginPath();
    ctx.moveTo(x0, y0);
    ctx.lineTo(x2,y2);
    ctx.lineTo(x2 - arrowWith, y2 + arrowWith);
    ctx.moveTo(x2,y2);
    ctx.lineTo(x2 + arrowWith, y2 + arrowWith);
    ctx.stroke();
    //plot the points
    var maxHeight = y0-y2;
    var maxWidth = x1-x0;
    ctx.beginPath();
    for( var i = 0; i <= data.length-1; i++ ) {
      var x=x0+maxWidth*0.8*time[i]/Math.max.apply(null, time);
      var y=y0-maxHeight*0.8*data[i]/Math.max.apply(null, data);
      if (i==0) {ctx.moveTo(x,y);}
      else {ctx.lineTo(x,y);}        
    }
    ctx.stroke();
    //plot xtick
    ctx.fillStyle = 'green';
    for (var i = 0; i < 6; i++) {
      ctx.moveTo(x0+i*maxWidth*0.8/5,y0);
      ctx.lineTo(x0+i*maxWidth*0.8/5,y0+5);
      ctx.stroke();
      ctx.font = "15px Times New Roman";
      var xtick=2*i;
      ctx.fillText(xtick.toString(), x0+i*maxWidth*0.8/5-5, y0+20);
    }

    //plot ytick
    var y_max=Math.max.apply(null, data);
    var scale=0.1;
    while(y_max<10){
      y_max=y_max*10;
      scale=scale*10;
    }
    if (y_max/10<=2.5) {y_max=Math.ceil(y_max/10*2)/2;interval=0.5;}
    else if(y_max/10<=5){y_max=Math.ceil(y_max/10);interval=1;}
    else{
      if (Math.ceil(y_max/10)%2==0) {y_max=Math.ceil(y_max/10);interval=2;}
      else{y_max=Math.ceil(y_max/10)+1;interval=2;}
    }
    num=y_max/interval;
    for (var i = 0; i <=num; i++) {       
      if (y0-i*0.8*y_max/scale*maxHeight/num/Math.max.apply(null, data)<y2) {break;}
      ctx.moveTo(x0,y0-i*0.8*y_max/scale*maxHeight/num/Math.max.apply(null, data));
      ctx.lineTo(x0-5,y0-i*0.8*y_max/scale*maxHeight/num/Math.max.apply(null, data));
      ctx.stroke();   
      ctx.font = "15px Times New Roman";
      var ytick=Math.trunc(interval*10*i)/scale/10;
      ctx.fillText(ytick.toString(), x0-30, y0-i*0.8*y_max/scale*maxHeight/num/Math.max.apply(null, data)+5);
    }

    //X axis legend
    ctx.font = "20px Times New Roman";
    ctx.fillText("Period (Seconds)", x0+40, y0+40);
    //Y axis legend
    ctx.save();
    ctx.font = "15px Times New Roman";
    ctx.translate(x0-35,y0);
    ctx.rotate(270*Math.PI/180);
    ctx.fillText('Spectral Accelaration,5% damped(g)',0,0);
    ctx.restore();

    //plot table
    ctx.font="15px Times New Roman";
    ctx.fillText("t(s)",canvas.width*0.5,y2);
    ctx.fillText("Sa(g)",canvas.width*0.5+40,y2);
    for (var i = 0; i < time.length; i++) {
    	ctx.fillText(time[i].toString(),canvas.width*0.5,y2+20*(i+1));
    	ctx.fillText(data[i].toString(),canvas.width*0.5+40,y2+20*(i+1));
    }
    ctx.moveTo(canvas.width*0.5-15,y2+5);
    ctx.lineTo(canvas.width*0.5+85,y2+5);
    ctx.moveTo(canvas.width*0.5+30,y2-20);
    ctx.lineTo(canvas.width*0.5+30,y2+150);
    ctx.stroke();
  }

  function addMarkersToMap(map,lagitude,longitude) {
  	var siteMarker = new H.map.Marker({lat:lagitude, lng:longitude});
    map.addObject(siteMarker);

  }
  
  function setUpClickListener(map){
    // Attach an event listener to map display
    // obtain the coordinates and display in an alert box.
    map.addEventListener('tap', function (evt) {
    var coord = map.screenToGeo(evt.currentPointer.viewportX,
            evt.currentPointer.viewportY);
    var lat=coord.lat;
    var lon=coord.lng;
    //predict the value at clicked location
    if ((lat<71&&lat>48.3&&lon<-123&&lon>-141)||(lat<83&&lat>48.9&&lon<-95&&lon>=-123)||(lat<83&&lat>48&&lon<-88&&lon>=-95)||(lat<83&&lat>46.9&&lon<-85&&lon>=-88)||(lat<83&&lat>45.3&&lon<-82.5&&lon>=-85)||(lat<83&&lat>=42&&lon<-78.9&&lon>=-82.5)||(lat<83&&lat>43.5&&lon<-76&&lon>=-78.9)||(lat<83&&lat>44.3&&lon<-74.9&&lon>=-76)||(lat<83&&lat>=45&&lon<-67&&lon>=-74.9)||(lat<70&&lat>=43.4&&lon<-52&&lon>=-67)) {
      var cityname=getKeyByValue(city_list,lat,lon)
      var tpredicted = kriging.predict(lat, lon, variogram);
      var tpredicted_snow=kriging.predict(lat, lon, variogram_snow);
      document.getElementById("lat").value=lat.toFixed(3);
      document.getElementById("lon").value=lon.toFixed(3);
      document.getElementById("wind").value=tpredicted.toFixed(2);
      document.getElementById("snow").value=tpredicted_snow.toFixed(1);
      if (cityname==undefined) {document.getElementById("city").value="";}
      else{document.getElementById("city").value=cityname;}
      plot_earthquake(lat,lon,coor);
      map.removeObjects(map.getObjects ());
      addMarkersToMap(map,lat,lon);
      
    }
    else{alert("The location you select seems not within Canada");}


    })
  }

  $(document).ready(function(){
    $("#city").keydown(function(){
      if (event.which===13) {$("#search").click();}     
    })

    $("#lon").keydown(function(){
      if (event.which===13) {$("#search").click();}
    })

    $("#clear").click(function(){
    	var canvas=document.getElementById("cavsElem");
        canvas.height=canvas.height;
    	map.removeObjects(map.getObjects ());
    })

    $("#search").click(function(){
      var city=$("#city").val();
      city=city.toLowerCase();
      var lat=$("#lat").val();
      var lon=$("#lon").val();
      if (city!="") {
        if (city in city_list) {
          var xnew=city_list[city][0];
          var ynew=city_list[city][1];
          var tpredicted = kriging.predict(xnew, ynew, variogram);
          var tpredicted_snow = kriging.predict(xnew, ynew, variogram_snow);
          $("#lat").val(xnew);
          $("#lon").val(ynew);
          $("#wind").val(tpredicted.toFixed(2));
          $("#snow").val(tpredicted_snow.toFixed(1));
          plot_earthquake(xnew,ynew,coor);
          map.removeObjects(map.getObjects ());
          addMarkersToMap(map,xnew,ynew);
        }
        else{
          alert("Can't find the city. Please select on the map or enter the coordinates");
        }
        

      }
      else if (lat!=""&&lon!="") {
        lat=Number(lat);
        lon=Number(lon);
        if (!isNaN(lat)&&!isNaN(lon)) {
          if ((lat<71&&lat>48.3&&lon<-123&&lon>-141)||(lat<83&&lat>48.9&&lon<-95&&lon>=-123)||(lat<83&&lat>48&&lon<-88&&lon>=-95)||(lat<83&&lat>46.9&&lon<-85&&lon>=-88)||(lat<83&&lat>45.3&&lon<-82.5&&lon>=-85)||(lat<83&&lat>=42&&lon<-78.9&&lon>=-82.5)||(lat<83&&lat>43.5&&lon<-76&&lon>=-78.9)||(lat<83&&lat>44.3&&lon<-74.9&&lon>=-76)||(lat<83&&lat>=45&&lon<-67&&lon>=-74.9)||(lat<70&&lat>=43.4&&lon<-52&&lon>=-67)) {
            var tpredicted = kriging.predict(lat, lon, variogram);
            var tpredicted_snow = kriging.predict(lat, lon, variogram_snow);
            $("#wind").val(tpredicted.toFixed(2));
            $("#snow").val(tpredicted_snow.toFixed(1));
            plot_earthquake(lat,lon,coor);
            map.removeObjects(map.getObjects ());
            addMarkersToMap(map,lat,lon);
          }
          else{alert("The location you enter seems not within Canada");}         
        }
        else{
          alert("Please enter the coordinates with the right format");
        }

      }
      else{
        alert("Please select a location to search");
      }

      
    })

  })

  //initialize a kriging model for wind
  var t = [84.21, 87.51, 80.21, 59.06, 83.79, 107.45, 103.05, 61.72, 132.22, 88.68, 85.68, 64.31, 166.5, 114.8, 96.15, 58.83, 92.82, 71.16, 65.77, 89.23, 70.95, 72.26, 90.94, 84.56, 98.86, 87.45, 65.72, 73.46, 72.23, 70.46, 99.1, 90.99, 77.49, 101.27, 84.31, 83.4, 94.5, 57.19, 57.47, 67.22, 53.28, 60.47, 58.55, 75.45, 69.44, 68.6, 80.23, 101.98, 85.85, 68.96, 63.48, 64.67, 66.7, 86.99, 85.18, 70.46, 115.86, 102.17, 103.34, 90.04, 110.69, 83.4, 110.53, 105.81, 130.52, 99.64, 98.17, 113.19, 110.17, 95.39, 118.73, 149.71, 119.5, 133.08, 90.69, 90.87, 108.01, 184.66, 100.59, 90.93, 77.95, 81.58, 72.26, 76.43, 112.96, 107.59, 82.91, 88.41, 70.56, 75.8, 68.36, 80.97, 87.11, 69.77, 77.21, 88.13, 67.82, 70.24, 79.94, 94.39, 99.16, 103.86, 98.62, 78.28, 84.97, 102.16, 91.45, 102.48, 86.63, 83.31, 97.36, 84.93, 69.27, 71.81, 81.29, 63.39, 82.51, 83.39, 92.75, 96.66, 85.56, 87.49, 70.15, 90.0, 70.54, 79.61, 90.26, 84.24, 64.31, 73.15, 63.2, 59.38, 71.06, 73.05, 64.2, 73.53, 66.26, 69.54, 82.24, 72.81, 72.07, 71.12, 90.13, 85.78, 69.59, 84.16, 85.74, 79.91, 73.54, 70.13, 64.61, 72.46, 88.84, 95.12, 92.3, 89.29, 70.46, 72.2, 97.46, 70.88, 104.61, 101.97, 107.35, 107.86, 105.59, 91.85, 90.35, 106.46, 98.76, 112.67, 78.82, 91.5, 101.86, 112.88, 79.13, 78.99, 73.57, 84.17, 92.42, 87.5, 134.43, 92.4, 91.91, 102.53, 89.57, 82.54, 110.27, 88.22, 89.46, 75.74, 69.92, 88.59, 88.89, 69.5, 94.71, 83.98, 118.92, 99.63, 90.76, 99.75, 75.72, 92.42, 94.77, 88.44, 84.7, 109.75, 105.27, 87.95, 101.16, 104.45, 91.29, 91.82, 93.76, 107.16, 98.76, 70.07, 130.87, 148.19, 99.86, 113.64, 92.41, 103.74, 114.83, 125.27, 119.79, 151.21, 127.2, 120.45, 104.7, 81.28, 92.76, 142.93, 121.82, 134.54, 79.77];
    var x = [48.65, 49.95, 49.72, 49.05, 50.68, 50.78, 49.38, 49.25, 50.0, 49.08, 49.83, 50.13, 51.93, 53.25, 54.29, 55.94, 54.47, 54.82, 54.23, 53.89, 53.03, 52.18, 49.03, 49.2, 49.37, 50.23, 49.96, 49.46, 49.3, 49.61, 49.75, 52.13, 50.7, 50.95, 55.69, 55.74, 56.24, 55.31, 58.43, 58.84, 64.04, 62.21, 63.62, 67.57, 60.17, 60.12, 60.71, 70.17, 62.72, 61.76, 60.02, 60.84, 68.3, 65.28, 69.43, 62.46, 64.3, 63.33, 65.48, 67.82, 64.19, 65.77, 62.82, 68.82, 82.52, 69.11, 64.23, 70.49, 79.98, 68.78, 63.75, 78.78, 68.9, 72.98, 66.15, 72.69, 74.72, 61.6, 76.23, 72.0, 52.07, 53.32, 53.31, 52.18, 51.11, 49.63, 50.02, 49.5, 52.88, 53.58, 56.65, 54.77, 55.3, 54.14, 58.77, 55.18, 58.62, 56.23, 54.42, 50.37, 49.22, 50.33, 50.43, 51.77, 51.27, 50.3, 49.17, 51.52, 52.77, 53.22, 52.17, 55.83, 57.35, 55.15, 54.13, 53.37, 53.33, 52.87, 49.91, 49.9, 49.92, 50.13, 52.36, 51.1, 54.68, 53.97, 58.74, 56.36, 53.85, 56.86, 55.8, 54.92, 53.83, 52.23, 51.45, 51.07, 48.75, 49.83, 49.79, 50.12, 50.29, 49.78, 48.37, 46.48, 48.6, 47.97, 46.63, 47.7, 49.41, 51.27, 48.57, 46.36, 45.88, 45.57, 44.22, 45.32, 45.95, 44.97, 44.75, 43.77, 42.99, 43.2, 42.85, 42.28, 43.03, 43.98, 43.45, 43.17, 43.68, 44.12, 44.23, 46.8, 45.47, 45.52, 45.43, 45.52, 46.3, 45.67, 46.05, 49.13, 51.45, 50.28, 50.18, 50.22, 48.78, 48.6, 47.51, 48.33, 48.52, 48.22, 49.77, 53.63, 53.2, 48.06, 58.47, 55.28, 58.1, 54.8, 47.98, 47.01, 45.87, 48.01, 46.1, 45.32, 47.16, 44.98, 44.88, 44.63, 46.17, 45.37, 43.99, 43.83, 46.29, 46.44, 47.29, 48.97, 48.67, 47.62, 49.27, 50.24, 49.22, 48.95, 47.57, 51.37, 47.62, 46.92, 48.53, 47.71, 53.71, 53.55, 53.32, 55.45, 56.55, 55.08, 52.93];

    var y = [-123.43, -125.27, -124.9, -123.87, -127.37, -128.43, -126.55, -124.83, -127.42, -125.77, -124.5, -122.95, -131.02, -131.81, -130.44, -129.99, -128.58, -127.18, -125.77, -122.68, -122.51, -122.05, -122.36, -123.18, -121.5, -121.58, -119.38, -119.6, -117.63, -115.78, -114.88, -119.29, -120.44, -118.17, -121.63, -120.18, -120.74, -123.14, -130.01, -122.6, -139.13, -133.38, -135.87, -139.84, -132.74, -128.82, -135.07, -124.72, -109.17, -121.24, -111.96, -115.78, -133.48, -126.8, -133.03, -114.44, -96.08, -90.72, -110.37, -115.14, -83.36, -111.23, -92.12, -93.43, -62.28, -105.14, -76.53, -68.52, -85.93, -81.24, -68.55, -103.53, -75.14, -84.62, -65.71, -77.97, -94.97, -64.63, -119.33, -125.27, -111.45, -113.58, -110.07, -113.89, -114.02, -112.8, -110.72, -112.12, -118.07, -116.47, -111.22, -112.02, -114.78, -115.79, -111.12, -118.88, -117.16, -117.45, -110.28, -102.57, -102.97, -105.55, -104.67, -104.2, -102.47, -107.68, -105.98, -109.18, -108.26, -105.67, -106.72, -108.43, -107.13, -105.27, -108.52, -107.55, -104.0, -102.4, -99.95, -98.27, -97.23, -96.22, -97.02, -100.05, -101.68, -101.1, -94.07, -94.71, -94.65, -101.08, -97.86, -98.63, -89.87, -87.88, -90.21, -93.79, -91.62, -92.75, -94.37, -91.9, -88.91, -86.93, -89.33, -84.51, -85.28, -84.78, -80.8, -79.85, -82.47, -80.65, -81.38, -79.42, -82.57, -77.42, -76.6, -75.67, -77.32, -79.3, -81.11, -81.72, -82.3, -79.17, -80.27, -82.96, -81.15, -80.75, -80.38, -79.93, -79.63, -77.53, -78.37, -71.38, -73.75, -73.42, -71.68, -75.57, -76.01, -74.03, -74.28, -68.2, -57.18, -63.6, -61.82, -66.27, -64.48, -68.22, -69.88, -71.0, -72.27, -78.83, -74.53, -77.7, -70.9, -77.79, -78.08, -77.75, -68.42, -66.82, -66.33, -65.47, -66.53, -64.49, -64.69, -65.89, -67.83, -64.92, -63.52, -63.5, -60.05, -63.27, -64.66, -66.09, -63.13, -63.83, -53.99, -56.07, -53.11, -57.62, -54.88, -57.58, -57.4, -54.58, -59.15, -55.6, -52.74, -55.38, -58.55, -59.31, -57.03, -64.1, -60.42, -60.22, -61.68, -59.19, -66.87];

    //initialize a kriging model for snow
    var x_snow=[51.644, 49.057, 49.24, 49.266, 50.728, 48.834, 56.1, 52.162, 52.374, 54.229, 50.807, 50.029, 49.495, 49.303, 55.698, 49.146, 49.673, 49.687, 49.51, 49.446, 48.864, 55.754, 58.438, 51.582, 48.779, 49.299, 49.504, 58.805, 56.248, 51.266, 49.789, 51.296, 49.031, 49.095, 49.4, 48.422, 50.676, 49.908, 49.88, 49.67, 53.727, 54.063, 48.993, 48.451, 50.686, 50.225, 55.338, 54.023, 53.304, 54.993, 50.109, 49.134, 49.079, 50.243, 49.191, 49.493, 52.354, 49.031, 49.324, 49.489, 49.25, 50.414, 50.723, 50.585, 48.554, 49.835, 53.918, 54.306, 49.46, 49.35, 53.257, 52.982, 51.002, 50.7, 53.243, 50.088, 48.653, 59.882, 54.782, 48.375, 49.702, 55.952, 49.926, 56.159, 54.517, 49.152, 49.095, 48.94, 49.249, 49.108, 49.217, 49.09, 49.099, 49.21, 49.32, 49.163, 49.106, 49.249, 49.337, 50.255, 48.419, 48.457, 48.429, 50.129, 49.024, 52.13, 48.873, 54.716, 51.178, 54.123, 55.209, 50.568, 51.045, 54.137, 53.017, 51.097, 49.195, 50.02, 54.464, 49.636, 52.09, 49.568, 51.44, 53.543, 53.584, 58.45, 56.072, 49.718, 56.728, 53.713, 53.933, 55.17, 58.812, 52.671, 50.582, 53.407, 52.879, 57.788, 54.769, 52.468, 49.693, 56.923, 50.041, 56.231, 49.486, 53.4, 52.267, 52.377, 55.279, 52.323, 53.53, 50.217, 49.787, 50.674, 55.067, 53.495, 53.933, 55.354, 52.836, 52.969, 54.138, 51.865, 49.629, 50.549, 52.059, 50.378, 51.754, 51.806, 49.139, 52.855, 52.202, 55.526, 51.565, 51.467, 53.276, 49.904, 54.124, 52.857, 50.931, 50.393, 53.357, 52.775, 53.2, 50.542, 50.455, 51.552, 52.134, 52.364, 51.07, 50.288, 59.569, 49.663, 51.214, 50.062, 49.229, 49.843, 58.755, 51.148, 54.769, 50.633, 53.865, 50.254, 56.844, 49.19, 50.232, 50.568, 49.973, 50.026, 49.325, 50.144, 56.023, 49.526, 52.105, 53.856, 55.746, 49.851, 49.886, 43.147, 43.85, 45.308, 44.152, 45.226, 50.297, 45.434, 48.757, 52.927, 44.006, 45.056, 44.381, 44.65, 44.43, 44.204, 42.881, 53.819, 44.272, 45.041, 44.12, 43.685, 43.153, 44.033, 44.602, 45.62, 43.349, 43.387, 51.254, 44.35, 45.143, 44.2, 43.284, 47.844, 42.405, 44.303, 43.617, 44.658, 43.959, 49.115, 44.005, 44.501, 45.028, 42.889, 46.097, 44.197, 42.985, 48.783, 42.584, 49.779, 44.169, 42.904, 44.176, 42.664, 47.711, 42.879, 46.408, 44.584, 43.154, 47.824, 46.247, 43.346, 44.537, 43.706, 43.097, 42.909, 42.885, 48.615, 44.33, 49.727, 42.746, 43.742, 45.917, 49.25, 44.917, 43.194, 43.539, 44.473, 47.442, 43.074, 42.962, 45.046, 43.64, 43.244, 44.153, 44.307, 45.605, 49.687, 44.871, 49.213, 45.327, 43.033, 48.71, 49.683, 49.413, 45.017, 49.793, 45.555, 44.175, 44.263, 44.782, 48.182, 43.434, 44.422, 52.219, 42.044, 44.354, 44.985, 43.734, 42.979, 43.188, 44.635, 44.319, 43.883, 49.25, 48.533, 46.314, 44.749, 43.5, 43.566, 44.925, 43.549, 43.555, 43.553, 43.469, 51.28, 44.9, 43.979, 50.167, 42.809, 42.787, 44.248, 47.513, 43.918, 43.913, 44.053, 43.095, 46.319, 44.382, 43.453, 43.915, 44.6, 43.89, 45.411, 44.567, 50.017, 43.193, 43.162, 45.348, 43.037, 45.82, 44.777, 44.899, 45.895, 44.309, 42.882, 43.835, 44.009, 43.303, 46.133, 42.649, 42.886, 44.432, 43.949, 44.105, 42.665, 44.715, 43.17, 48.833, 46.578, 51.061, 45.472, 43.885, 45.548, 42.985, 46.495, 48.813, 43.553, 44.08, 42.836, 50.09, 44.9, 43.095, 49.268, 45.842, 44.495, 43.183, 43.259, 42.779, 44.296, 43.369, 42.956, 46.367, 46.49, 45.774, 43.321, 47.067, 43.059, 43.163, 48.416, 42.862, 48.485, 48.494, 43.644, 43.767, 43.773, 43.653, 44.1, 45.987, 44.106, 43.833, 42.762, 44.131, 42.593, 43.481, 42.95, 47.992, 42.993, 42.604, 43.898, 43.957, 48.594, 44.74, 42.293, 43.885, 43.131, 42.955, 45.633, 48.568, 48.582, 45.776, 45.407, 49.232, 47.462, 46.878, 45.12, 45.568, 45.194, 45.455, 45.583, 45.733, 45.441, 45.109, 45.857, 45.208, 45.544, 48.877, 45.881, 45.284, 45.841, 51.801, 48.903, 45.484, 46.093, 45.399, 50.47, 50.243, 45.05, 45.428, 45.308, 58.456, 46.023, 58.107, 55.275, 47.37, 47.682, 47.438, 45.583, 45.658, 45.368, 45.35, 46.855, 46.25, 45.265, 48.139, 46.379, 45.55, 48.85, 48.587, 46.553, 46.967, 45.424, 45.45, 45.578, 45.509, 45.631, 45.599, 45.514, 45.467, 45.492, 45.506, 45.404, 45.45, 46.217, 53.195, 48.247, 48.524, 45.374, 46.219, 50.028, 61.367, 46.799, 46.803, 46.802, 46.779, 46.779, 45.662, 48.433, 47.836, 48.514, 45.008, 45.633, 48.237, 48.422, 48.33, 48.447, 48.428, 45.57, 46.921, 45.25, 54.821, 48.389, 50.2, 46.55, 45.604, 45.405, 46.03, 48.658, 47.919, 45.483, 47.791, 45.625, 45.783, 46.118, 45.451, 46.7, 46.049, 45.105, 48.156, 46.717, 45.715, 46.089, 45.597, 46.354, 48.103, 45.678, 45.773, 46.058, 47.331, 45.631, 45.342, 45.569, 45.607, 47.62, 48.003, 47.377, 45.954, 45.777, 47.046, 47.024, 46.116, 45.844, 45.91, 45.075, 45.127, 45.273, 47.741, 45.192, 46.152, 45.829, 45.623, 44.378, 45.333, 45.438, 44.624, 43.574, 44.664, 44.649, 45.075, 44.032, 43.7, 44.68, 44.376, 45.584, 46.207, 45.678, 45.618, 45.645, 45.137, 46.136, 45.712, 45.358, 45.091, 43.835, 46.248, 46.354, 46.393, 46.951, 47.302, 48.653, 48.826, 54.933, 46.66, 47.572, 48.95, 48.957, 47.1, 48.933, 53.326, 52.939, 51.372, 47.561, 48.55, 53.5, 47.644, 52.902, 61.6, 64.051, 61.254, 62.229, 60.755, 62.399, 60.226, 60.065, 60.717, 68.227, 66.001, 66.259, 67.431, 61.382, 60.988, 61.817, 60.014, 60.803, 70.733, 68.337, 76.248, 65.274, 62.823, 61.95, 63.187, 62.455, 82.516, 73.038, 61.096, 64.318, 69.115, 63.347, 70.474, 67.828, 64.139, 79.984, 63.747, 78.794, 63.117, 62.81, 74.686, 61.313];

    var y_snow=[-121.294, -122.285, -121.766, -124.814, -121.275, -125.143, -120.383, -128.146, -126.763, -125.763, -121.323, -125.274, -119.123, -117.66, -121.63, -121.941, -124.928, -124.993, -115.764, -117.558, -123.646, -120.234, -129.999, -122.238, -123.709, -115.111, -115.062, -122.697, -120.853, -117.516, -126.048, -116.963, -118.445, -118.677, -121.351, -124.045, -120.341, -116.91, -119.45, -115.978, -127.648, -128.638, -123.822, -123.504, -121.935, -121.577, -123.094, -132.099, -120.161, -123.044, -120.78, -122.311, -117.592, -117.8, -123.982, -117.294, -127.694, -119.465, -124.314, -119.582, -124.807, -127.473, -127.493, -127.096, -124.423, -124.525, -122.777, -130.311, -120.508, -124.433, -132.088, -122.493, -118.197, -119.28, -131.821, -123.746, -123.404, -126.433, -127.168, -123.734, -123.159, -129.897, -126.662, -120.688, -128.608, -125.902, -117.71, -125.544, -122.974, -122.75, -122.623, -123.082, -122.654, -122.917, -123.068, -123.138, -122.828, -123.109, -123.16, -119.292, -123.332, -123.326, -123.366, -122.956, -122.803, -122.138, -124.199, -113.28, -115.572, -114.401, -119.429, -111.894, -114.057, -114.651, -112.833, -115.348, -113.302, -113.582, -110.183, -114.503, -111.441, -114.069, -112.682, -113.49, -116.435, -111.484, -118.376, -113.402, -111.381, -113.213, -116.577, -118.8, -118.707, -111.311, -113.869, -117.57, -118.079, -117.856, -111.982, -113.737, -112.842, -117.629, -110.678, -117.289, -113.948, -111.684, -113.802, -114.919, -114.768, -112.71, -114.006, -111.165, -112.145, -114.274, -117.281, -112.053, -116.576, -114.985, -110.859, -113.377, -115.677, -113.594, -105.988, -108.335, -107.979, -102.579, -104.528, -106.502, -102.986, -102.384, -105.123, -102.348, -101.898, -109.154, -110.0, -109.478, -108.436, -104.606, -102.808, -105.552, -104.019, -108.287, -105.742, -103.878, -104.607, -107.989, -106.648, -108.834, -104.953, -107.793, -108.61, -103.853, -102.463, -96.516, -100.057, -99.95, -94.112, -100.049, -101.85, -96.985, -94.668, -96.061, -101.088, -98.108, -99.461, -96.216, -98.29, -100.235, -96.293, -96.884, -95.812, -96.684, -101.26, -101.207, -97.85, -100.932, -97.153, -81.524, -79.017, -74.634, -79.868, -76.194, -89.058, -76.358, -91.626, -82.429, -79.45, -77.855, -79.687, -75.733, -79.154, -77.379, -81.088, -89.835, -79.912, -79.234, -79.562, -79.76, -80.264, -77.733, -75.691, -79.409, -79.79, -80.321, -85.323, -79.039, -79.141, -78.469, -81.472, -83.404, -82.191, -81.097, -81.539, -78.799, -78.168, -81.038, -77.888, -80.217, -74.74, -82.453, -77.494, -77.05, -81.049, -88.533, -82.18, -92.793, -80.393, -79.618, -80.818, -81.503, -79.825, -82.481, -82.65, -79.866, -80.9, -79.873, -81.764, -81.48, -78.736, -80.379, -82.0, -78.993, -79.059, -93.402, -76.164, -86.949, -81.709, -81.708, -82.467, -90.573, -79.367, -79.56, -80.248, -79.55, -79.661, -79.952, -80.052, -78.509, -79.932, -79.889, -81.026, -77.956, -74.611, -83.667, -79.817, -84.771, -79.217, -80.883, -80.766, -87.517, -82.419, -75.645, -94.466, -77.416, -81.636, -79.503, -78.651, -80.022, -80.478, -78.273, -87.891, -82.576, -78.739, -81.253, -80.951, -81.246, -81.403, -75.613, -80.648, -79.25, -91.148, -80.464, -78.711, -79.884, -79.917, -80.922, -78.824, -79.626, -79.588, -79.584, -81.191, -80.646, -75.185, -80.732, -86.7, -80.082, -80.203, -76.951, -79.677, -78.589, -78.69, -79.459, -79.057, -79.434, -77.98, -79.702, -80.109, -79.417, -78.86, -75.698, -80.933, -85.217, -80.384, -81.684, -80.034, -79.329, -77.111, -79.927, -76.249, -77.283, -78.32, -82.144, -79.089, -77.139, -80.621, -77.567, -80.806, -79.251, -81.392, -78.294, -78.944, -81.215, -75.519, -80.527, -89.933, -81.198, -93.78, -76.683, -79.43, -75.292, -82.361, -84.345, -87.266, -81.393, -80.2, -80.307, -91.919, -76.017, -79.549, -81.592, -79.377, -81.37, -79.233, -81.143, -81.183, -77.547, -80.981, -81.625, -79.931, -81.01, -79.389, -80.836, -79.783, -80.996, -81.857, -89.267, -80.727, -81.301, -81.17, -79.523, -79.413, -79.258, -79.382, -77.577, -79.36, -79.123, -79.5, -80.323, -81.151, -82.388, -80.538, -81.88, -84.771, -79.239, -81.607, -78.943, -78.96, -85.275, -81.14, -82.993, -81.314, -80.747, -82.119, -72.567, -71.664, -78.109, -71.939, -75.83, -68.212, -70.505, -71.192, -72.983, -73.212, -72.572, -73.471, -75.417, -76.596, -73.287, -71.832, -73.239, -72.75, -73.9, -72.227, -72.5, -72.977, -76.738, -68.167, -64.479, -75.646, -76.053, -72.722, -59.609, -63.603, -73.585, -75.711, -73.236, -78.118, -73.439, -68.399, -77.758, -70.034, -70.138, -72.781, -70.883, -74.331, -71.852, -73.8, -71.361, -72.933, -72.147, -78.122, -75.973, -75.418, -67.517, -68.193, -75.497, -70.55, -73.867, -73.75, -73.745, -73.554, -73.519, -73.629, -73.606, -73.883, -73.502, -73.708, -73.95, -73.567, -72.617, -70.911, -79.028, -64.213, -73.987, -71.772, -66.867, -75.25, -71.362, -71.176, -71.245, -71.25, -71.281, -72.141, -68.517, -69.536, -72.233, -72.098, -73.817, -79.014, -71.062, -70.878, -71.241, -71.23, -73.897, -70.89, -74.133, -66.825, -77.24, -66.383, -72.733, -76.493, -71.893, -73.112, -72.451, -69.5, -73.433, -69.163, -72.95, -74.0, -74.6, -74.142, -71.4, -74.28, -72.615, -69.715, -79.083, -73.632, -71.302, -75.243, -72.582, -77.788, -73.418, -73.352, -71.965, -79.441, -75.925, -72.522, -72.006, -64.938, -65.65, -66.675, -68.325, -66.645, -66.159, -67.74, -65.512, -64.803, -66.476, -64.373, -67.053, -66.83, -66.065, -64.715, -67.277, -67.598, -64.207, -61.992, -64.521, -60.995, -63.46, -65.757, -65.386, -63.568, -63.575, -64.502, -64.718, -65.114, -63.532, -64.319, -62.645, -60.252, -62.71, -61.359, -64.061, -63.349, -60.196, -63.291, -63.282, -64.359, -66.115, -63.12, -62.251, -63.79, -64.033, -53.987, -53.11, -56.852, -57.917, -53.075, -59.136, -57.95, -54.609, -55.783, -55.635, -60.414, -66.92, -55.595, -52.713, -58.55, -64.514, -52.947, -66.87, -137.509, -139.418, -138.807, -133.351, -137.509, -140.372, -132.771, -128.703, -135.05, -135.003, -117.741, -128.598, -134.826, -117.651, -113.802, -121.314, -112.106, -115.807, -117.75, -133.608, -119.35, -126.698, -115.988, -128.267, -123.353, -114.376, -62.308, -85.188, -94.072, -96.018, -105.06, -90.737, -68.586, -115.122, -83.17, -85.829, -68.517, -103.551, -77.933, -92.099, -94.909, -64.869];

    var t_snow=[2.6, 2.0, 2.4, 3.0, 1.7, 1.0, 3.3, 2.6, 5.5, 3.4, 1.7, 3.3, 3.9, 4.2, 2.4, 2.2, 2.6, 2.6, 3.0, 4.2, 1.8, 2.5, 2.6, 1.8, 1.8, 3.6, 4.5, 2.4, 2.8, 9.4, 2.6, 3.7, 2.8, 4.0, 2.8, 1.2, 1.8, 2.8, 1.7, 3.0, 5.5, 6.5, 2.4, 1.8, 2.1, 2.8, 5.1, 1.8, 4.3, 4.1, 1.8, 2.4, 4.1, 4.4, 2.3, 4.2, 3.9, 1.1, 2.4, 1.3, 3.0, 1.1, 0.9, 1.1, 1.1, 1.9, 3.4, 1.9, 2.9, 2.2, 1.8, 3.0, 5.8, 3.5, 1.8, 2.2, 1.1, 2.8, 3.2, 1.3, 3.2, 7.9, 1.1, 2.3, 5.4, 1.1, 4.1, 1.0, 2.9, 2.5, 2.4, 1.3, 2.4, 2.3, 3.0, 1.5, 2.4, 1.8, 2.4, 2.2, 1.5, 2.1, 1.1, 9.5, 2.0, 2.4, 3.9, 1.5, 3.6, 1.7, 2.4, 1.2, 1.1, 1.7, 2.0, 3.5, 1.5, 1.3, 1.7, 2.7, 2.2, 1.6, 1.2, 1.7, 2.1, 1.9, 2.6, 1.2, 1.4, 1.6, 2.1, 2.2, 2.4, 1.7, 1.3, 2.9, 3.3, 2.4, 1.6, 2.1, 1.2, 2.3, 1.1, 2.2, 1.5, 1.9, 2.0, 1.9, 1.9, 2.2, 1.7, 1.3, 1.2, 1.4, 2.3, 1.9, 1.7, 1.9, 2.0, 2.0, 1.9, 1.6, 1.6, 1.2, 2.1, 1.7, 1.7, 1.5, 1.6, 2.0, 2.1, 2.1, 2.1, 1.4, 2.0, 1.2, 1.7, 2.1, 1.7, 1.4, 2.0, 1.7, 1.9, 1.7, 1.4, 1.7, 1.7, 1.9, 1.5, 1.4, 2.0, 1.4, 1.7, 1.9, 2.2, 2.1, 2.8, 1.9, 2.2, 1.9, 2.6, 1.9, 2.4, 2.2, 2.2, 1.9, 2.1, 2.1, 2.2, 1.9, 2.5, 2.0, 2.0, 2.1, 2.4, 2.0, 1.9, 2.2, 1.0, 2.4, 2.0, 2.5, 2.7, 2.5, 2.4, 2.8, 2.0, 3.1, 2.5, 2.1, 2.2, 1.7, 1.7, 3.2, 2.2, 3.1, 2.1, 1.3, 1.3, 1.6, 2.2, 2.7, 0.9, 1.6, 1.7, 2.2, 2.5, 2.0, 2.3, 4.0, 1.0, 2.8, 2.6, 2.5, 1.2, 2.8, 1.6, 2.7, 2.2, 1.0, 2.5, 1.9, 1.9, 2.8, 1.0, 2.4, 3.4, 2.0, 2.8, 1.3, 2.6, 2.4, 2.9, 2.6, 2.0, 2.5, 2.3, 2.4, 2.3, 2.2, 2.0, 2.6, 2.5, 2.3, 2.1, 2.9, 1.5, 2.4, 2.6, 2.6, 2.7, 0.9, 1.9, 2.5, 2.4, 1.2, 1.3, 2.9, 1.4, 0.9, 2.6, 2.0, 2.3, 2.8, 2.7, 3.6, 2.9, 1.7, 2.9, 2.7, 2.8, 2.3, 2.3, 2.7, 2.6, 2.1, 2.7, 2.9, 2.0, 2.2, 2.9, 0.8, 2.3, 2.7, 2.6, 1.9, 2.3, 2.2, 3.4, 1.3, 2.6, 2.8, 2.1, 2.7, 1.3, 2.4, 2.7, 1.1, 1.1, 0.9, 2.4, 2.2, 2.3, 2.7, 2.8, 1.4, 1.2, 1.9, 2.3, 1.5, 1.4, 2.0, 2.0, 2.2, 2.1, 0.9, 2.3, 2.4, 1.4, 2.4, 2.8, 2.4, 1.4, 2.1, 2.8, 2.3, 2.5, 2.8, 2.3, 2.6, 2.0, 1.3, 1.0, 2.0, 1.9, 2.5, 1.2, 2.3, 2.8, 1.2, 2.4, 1.2, 2.2, 1.5, 2.7, 2.5, 2.4, 2.5, 1.5, 2.4, 1.1, 3.1, 3.3, 2.5, 3.1, 1.3, 2.4, 2.3, 1.5, 2.7, 2.8, 2.7, 1.0, 2.2, 1.4, 1.7, 2.3, 1.9, 2.2, 2.5, 2.8, 2.1, 2.6, 1.9, 2.1, 2.9, 1.3, 3.1, 2.9, 1.1, 1.2, 1.2, 0.9, 1.6, 2.7, 2.4, 1.1, 1.3, 2.7, 0.9, 2.0, 1.9, 4.1, 2.2, 1.3, 1.2, 1.9, 4.5, 2.7, 0.8, 2.6, 1.9, 1.6, 2.3, 3.3, 3.2, 2.8, 2.5, 4.3, 3.2, 3.4, 2.1, 2.4, 2.5, 2.4, 2.6, 2.6, 2.3, 2.3, 2.8, 2.3, 2.4, 3.5, 2.5, 2.2, 2.5, 4.6, 4.3, 2.5, 2.6, 2.3, 4.9, 4.1, 2.4, 2.4, 2.2, 4.4, 3.1, 4.8, 4.5, 3.2, 3.1, 3.4, 3.2, 2.4, 2.0, 2.3, 3.7, 2.9, 2.3, 3.3, 2.4, 2.4, 3.7, 4.0, 2.6, 2.9, 2.3, 2.4, 2.6, 2.6, 2.7, 2.6, 2.8, 2.4, 2.5, 2.5, 2.3, 2.5, 2.8, 3.5, 3.2, 3.8, 2.3, 2.8, 4.1, 4.5, 3.4, 3.3, 3.6, 3.1, 3.7, 2.2, 3.8, 3.3, 3.5, 2.0, 2.6, 3.1, 2.5, 2.4, 3.1, 3.1, 2.4, 2.2, 2.3, 4.5, 3.3, 4.1, 3.1, 2.8, 2.2, 2.8, 3.5, 3.2, 2.5, 4.4, 2.3, 2.7, 2.8, 2.3, 3.5, 3.4, 2.4, 3.4, 2.5, 2.6, 3.3, 2.4, 2.8, 3.4, 2.6, 2.7, 2.6, 2.3, 3.1, 2.5, 2.3, 2.3, 3.5, 3.6, 3.4, 3.1, 2.8, 3.6, 3.4, 3.0, 3.0, 2.5, 2.3, 2.3, 2.3, 3.4, 2.5, 3.1, 2.4, 2.1, 1.9, 1.7, 2.1, 2.2, 2.7, 1.6, 1.9, 2.4, 1.7, 1.4, 2.1, 1.9, 2.2, 2.4, 2.2, 2.1, 3.1, 1.8, 2.3, 2.2, 2.0, 2.4, 1.8, 2.7, 2.7, 3.1, 3.2, 2.4, 2.8, 4.7, 6.3, 2.3, 3.0, 3.7, 3.7, 2.4, 3.4, 5.3, 4.3, 5.1, 2.9, 3.5, 4.6, 3.0, 4.3, 1.9, 2.7, 1.6, 2.3, 2.2, 2.2, 2.9, 3.1, 1.8, 2.3, 3.0, 2.9, 2.3, 2.4, 2.3, 2.3, 2.3, 2.4, 2.1, 2.3, 1.5, 2.7, 2.3, 4.3, 2.8, 2.2, 1.6, 2.1, 2.9, 2.9, 1.6, 3.0, 3.5, 2.6, 3.8, 1.6, 2.9, 1.6, 4.5, 3.0, 1.7, 5.2];


    var model = "exponential";
    var sigma2 = 0, alpha = 100;
    var variogram = kriging.train(t, x, y, model, sigma2, alpha);
    var variogram_snow=kriging.train(t_snow, x_snow, y_snow, model, sigma2, alpha);

    
    
    
</script>

<style type="text/css">
  #map{
    width: 60%;
    height: 700px;
    background: grey;
  }

  #content{
    position: absolute;
    top: 300px;
    right: 100px;
    width: 30%;
    padding: : 20px;
  }

  input{
    padding: 10px;
    margin: 10px;
  }

  #chart{
    position: absolute;
    top: 10px;
    right:15%;
  }



</style>

</head>
<body>
  <div id="map"></div>
  <div id="chart"><canvas id="cavsElem" width="300" height="300" style="border:1px solid #c3c3c3;" >Your browser does not support the canvas element.</canvas></div>
  <div id="content">
    <p style="font-size:25px">Please click on the map to select a place or enter a city/coordinates within Canada:</p>
    <form>
      <span style="position: relative;left: 20px">City:</span>:<input type="text" id="city" style="position: relative;left: 20px;width:120px">
      <br/>
      Latitude:<input type="text" id="lat" style="width:80px"> Longitude:<input type="text" id="lon" style="width:80px">
      <br/>
      <button type="button" id="search" style="height: 40px; width: 60px;position:relative;left:70px">Search</button>
      <input type="reset" id="clear" style="height: 40px; width: 60px;position:relative;left:70px">
      <br/>
      50-year return period of wind speed: <input type="text" id="wind" style="width:50px">km/h
      <br/>
      50-year return period of snow load in NBCC2010: <input type="text" id="snow" style="width:40px">kpa
    </form>
  </div>
  
  <script  type="text/javascript" charset="UTF-8" >
/**
 * Boilerplate map initialization code starts below:
 */

//Step 1: initialize communication with the platform
var platform = new H.service.Platform({
  app_id: 'devportal-demo-20180625',
  app_code: '9v2BkviRwi9Ot26kp2IysQ',
  useHTTPS: true
});
var pixelRatio = window.devicePixelRatio || 1;
var defaultLayers = platform.createDefaultLayers({
  tileSize: pixelRatio === 1 ? 256 : 512,
  ppi: pixelRatio === 1 ? undefined : 320
});

//Step 2: initialize a map
var map = new H.Map(document.getElementById('map'),
  defaultLayers.normal.map,{
  center: {lat: 60, lng: -108},
  zoom: 3,
  pixelRatio: pixelRatio
});

//Step 3: make the map interactive
// MapEvents enables the event system
// Behavior implements default interactions for pan/zoom (also on mobile touch environments)
var behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));

setUpClickListener(map);
var ui = H.ui.UI.createDefault(map, defaultLayers);
  </script>
</body>
</html>